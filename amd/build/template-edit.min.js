define("tool_davidcerezal/template-edit",["exports","core/modal_delete_cancel","core/str","core/modal_events","core/notification","core/prefetch","core/ajax","core/templates"],(function(_exports,_modal_delete_cancel,_str,_modal_events,_notification,_prefetch,_ajax,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module used when editing davidCerezal table
   *
   * @module     tool_davidcerezal
   * @copyright  2024 David Cerezal
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal_delete_cancel=_interopRequireDefault(_modal_delete_cancel),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);const SELECTORS_DELETEROW="[data-action='delete']",SELECTORS_TABLEREGION=".hero-unit",deleteRowCall=(rowId,courseId,userId)=>({methodname:"tool_davidcerezal_delete",args:{rowid:rowId,courseid:courseId,userid:userId}}),getCourseTemplate=courseId=>({methodname:"tool_davidcerezal_get_template",args:{courseid:courseId}});var _default={init:userId=>{(0,_prefetch.prefetchStrings)("tool_davidcerezal",["deleteconfirm","deleteerror","deletetitle","deleteentry"]),document.addEventListener("click",(async event=>{const deleteRowElement=event.target.closest(SELECTORS_DELETEROW);deleteRowElement&&(event.preventDefault(),await(async(deleteRowElement,userId)=>{const modal=await _modal_delete_cancel.default.create({title:(0,_str.get_string)("deleteentry","tool_davidcerezal"),body:(0,_str.get_string)("deletetitle","tool_davidcerezal")}).then((modal=>(modal.show(),modal)));modal.getRoot().on(_modal_events.default.delete,(()=>{const rowId=deleteRowElement.getAttribute("data-id"),courseId=deleteRowElement.getAttribute("data-courseid"),checkheader=document.querySelector(SELECTORS_TABLEREGION),responses=(0,_ajax.call)([deleteRowCall(rowId,courseId,userId),getCourseTemplate(courseId)]);responses[0].fail((()=>{_notification.default.addNotification({message:"Error deleting row",type:"error"})})),responses[1].done((data=>{_templates.default.render("tool_davidcerezal/index_page",data.content).then(((html,js)=>{_templates.default.replaceNodeContents(checkheader,html,js),_templates.default.runTemplateJS(js)})).catch(_notification.default.exception),_notification.default.addNotification({message:"Row deleted successfully",type:"success"})})).fail((()=>{_notification.default.addNotification({message:"Error updating row html",type:"error"})})),modal.hide()}))})(deleteRowElement,userId))}))}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=template-edit.min.js.map